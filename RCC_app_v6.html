<!DOCTYPE>
<html lang="en">
    <head>
        <title>RCC Global Distribution Map</title>
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
        <link rel="shortcut icon" href="http://cartodb.com/assets/favicon.ico"/>
        <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
        <style>  
            @font-face {
                font-family="Champ&Lim"
                src = url('http://dl.dafont.com/dl/?f=champagne_limousines.tff');
            }
            html, body, #map {
                height:100%;
                padding:0;
                margin:0;                   
            } 
            #userInput {
                position: absolute;
                top: 50px;
                left: 75px;
                padding: 5px;
                border: 2px solid #c0c0c0;
                float: left;
                width: 275px;
                -moz-border-radius: 5px;
                -webkit-border-radius: 5px;
                border-radius: 5px;
                height: 30px;
                margin-bottom: 10px;
                margin-top: 10px;
                margin-left: 10px;
                margin-right: 10px;
                font-family: 'Champ&Lim';
                font-size: 14;
            }
            #reset-button {
                background: #FFF;
                position: absolute;
                float:left;
                right: 80px;
                top:50px;
                padding: 5px;
                -moz-border-radius: 5px;
                -webkit-border-radius: 5px;
                width: auto;
                margin-bottom: 10px;
                margin-top: 10px;
                margin-left: 10px;
                margin-right: 10px;
                font-family: 'Champ&Lim';
                font-size: 14;
            }
            #reset-button.active, #reset-button:hover {
                background-color: #ddd
            }
            .search-button {
                background: #FFF;
                position: absolute;
                float:left;
                left: 360px;
                top:50px;
                padding: 5px;
                border: 2px solid #c0c0c0;
                -moz-border-radius: 5px;
                -webkit-border-radius: 5px;
                border-radius: 5px;
                width: auto;
                height: auto;
                margin-bottom: 10px;
                margin-top: 10px;
                margin-left: 10px;
                margin-right: 10px;
            }
            .ui-tooltip-content {
                font-family: 'Champ&Lim';
                background: black transparent;
                font-size:14px;
                height:auto;
                width:auto;
                padding:1px;
            }
            #accordion {
                font-family: 'Champ&Lim';
                font-size: 14;
                color: black;
                text-align: left;
                position: absolute;
                width: auto;
                height: auto;
                bottom: 50px;
                left: 10px;
                float: left;
                margin-bottom: 10px;
                margin-top: 10px;
                margin-left: 10px;
                margin-right: 10px;
            }
            #accordion.active, .accordion:hover {
                background-color: #ddd
            }
            #panel {
                font-family: "Champ&Lim";
                width: auto;
                height: 125px;
                padding: 5px;
            }
            #radio {
                position: absolute;
                font-family: "Champ&Lim";
                font-size: 14;
                align-content: center;
                align-items: center;
                top:50px;
                right:300px;
                margin-bottom: 10px;
                margin-top: 10px;
                margin-left: 10px;
                margin-right: 10px;
            }
            #reset-filter {
                font-family: "Champ&Lim";
                width: 150px;
                height: auto;
                margin-bottom: 10px;
                margin-top: 12px;
                margin-left: 10px;
                margin-right: 10px;
            }
        </style>
        <script src='http://code.jquery.com/jquery-latest.min.js'></script>
        <script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
        <link href="http://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css" rel="stylesheet">
        <script src="http://libs.cartocdn.com/cartodb.js/v3/3.15.9/cartodb.js"></script>
        <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.css" />
    </head>
    <script>
        function main() {
            //map url that points to vis Json link for CartoDB
            mapURL = 'https://mccook3.cartodb.com/api/v2/viz/3136e62c-98bf-11e5-8d04-0ef24382571b/viz.json'
            //creatVis used here because it allows me to bring a Mapbox studio classic map
            var options = {
                center: [0,0],
                zoom: 2,
                scrollwheel: true 
            }
            cartodb.createVis('map', mapURL, options).on('done', function(vis, layers) {  
                map = vis.getNativeMap();
                var basemap = layers[0];
                var layer = layers[1];
            }).on('error', function(err) {
                console.log(err);
            });         
            // use a click event to regester the information from the search bar
            var sql = new cartodb.SQL({user: 'mccook3'});
            $('.search-button').click(function() {
                var input = $("#userInput").val();    
                    console.log(input);
                    query = "SELECT * FROM rcc_fellows_locations WHERE first_last ILIKE '%" + input + "%' OR(institution ILIKE '%" + input + "%') OR(geographic_area ILIKE '%" + input + "%') OR(geographic_area2 ILIKE '%" + input + "%') OR(subj ILIKE '%" + input + "%') OR(subj2 ILIKE '%" + input + "%') OR(subj3 ILIKE '%" + input + "%')";
                    console.log(query);
                    sql.getBounds(query).done(function(bounds) {
                        latlng = bounds[0]
                        console.log(latlng);
                        map.fitBounds(bounds);
                });
            });
            function checkboxSQL() {
                var checkbox_sql = new cartodb.SQL({user: 'mccook3'});
                query = "SELECT * FROM rcc_fellows_locations WHERE male_female ILIKE '%male%'"
                $('#male').click(function() {
                    if($('#male').checked) {
                        sql.execute(query);
                } else {
                    sql.execute("SELECT * FROM rcc_fellows_locations");
                }
            });
            }
            //allow enter key to initiate the userInput value
            $('#userInput').keypress(function(event){
                if(event.keyCode == 13){
                    $('.search-button').click();
                }
            });
            //highlight text when user click the search bar
            $('#userInput').click(function(){
                $(this).select();
            });
            //add tooltip to search box to prompt the search categories
            $(function(){
                $('#userInput').tooltip({
                    track:true,
                });
            });
            //reset view button event
            $('#reset-button').click(function() {
                map.setView([0, 0], 2);
            }); 
            $("#accordion").accordion({
                collapsible: true,
                active: false,
                event: "mouseover"
            });
            $(function(){
                $("#radio").buttonset();
            });
//            function checkboxSQL(){
//                var checkSQL = new cartodb.
//            }
            $('#male').change(function() {
                if($(this).is(':checked')){
                    $('#female').attr('disabled', true);
                    $(this).attr('disabled', false);
                }
                else{
                    $('#female').attr('disabled', false);
                }
            });
            $('#female').change(function(){
                if($(this).is(':checked')){
                    $('#male').attr('disabled', true);
                    $(this).attr('disabled', false);
                }
                else{
                    $('#male').attr('disabled', false)
                }
            })
        }
        window.onload = main;
    </script>
    <body>
        <div id="map"></div>
        <div id="search-container">
            <input type='Text' id='userInput' title='Search by Name, Topic of Research, Institution, or Geographic Area of Interest.'>
            <input type="button" id="reset-button" value="Reset View">
            <a href="#" class="search-button"><i class="fa fa-search"></i></a>
        </div>  
        <div id="accordion">
            <h1>Filter Option</h1>
            <div id="panel">
                <p>Filter by Gender:</p>
                <p><label><input type="checkbox" id="male"/>Male</label></p>
                <p><label><input type="checkbox" id="female"/>Female</label></p>
                <p>Show RCC BNB Hosts:</p>
                <p><input type="checkbox" id="rcc_bnb"><label for="rcc_bnb">Willing Hosts</label></p>
                <p><input type="button" id="reset-filter" value="Reset Filters"></p>
            </div>
        </div>
<!--
        <div id="radio">
            <input type="radio" id="satellite"><label for="satellite">Satellite</label>
            <input type="radio" id="streets"><label for="streets">Streets</label>
        </div>
-->
    </body>
</html>